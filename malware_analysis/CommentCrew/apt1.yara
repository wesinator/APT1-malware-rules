

rule LIGHTDART_APT1 {
	strings:
		$s1 = "ret.log"
		$s2 = "Microsoft Internet Explorer 6.0"
		$s3 = "szURL Fail"
		$s4 = "szURL Successfully"
		$s5 = "%s&sdate=%04ld-%02ld-%02ld"
	condition:
		all of them
}

rule AURIGA_APT1 {
	strings:
		$s1 = "superhard corp."
		$s2 = "microsoft corp."
		$s3 = "[Insert]"
		$s4 = "[Delete]"
		$s5 = "[End]"
		$s6 = "!(*@)(!@KEY"
		$s7 = "!(*@)(!@SID="
	condition:
		all of them
}

rule AURIGA_driver_APT1 {
	strings:
		$s1 = "Services\\riodrv32"
		$s2 = "riodrv32.sys"
		$s3 = "svchost.exe"
		$s4 = "wuauserv.dll"
		$s5 = "arp.exe"
		$pdb = "projects\\auriga"
		
	condition:
		all of ($s*) or $pdb
}

rule BANGAT_APT1 {
	strings:
		$s1 = "superhard corp."
		$s2 = "microsoft corp."
		$s3 = "[Insert]"
		$s4 = "[Delete]"
		$s5 = "[End]"
		$s6 = "!(*@)(!@KEY"
		$s7 = "!(*@)(!@SID="
		$s8 = "end	binary output"
		$s9 = "XriteProcessMemory"
		$s10 = "IE:Password-Protected sites"
		$s11 = "pstorec.dll"
		
	condition:
		all of them
}

rule BISCUIT_GREENCAT_APT1 {
	strings:
		$s1 = "zxdosml"
		$s2 = "get user name error!"
		$s3 = "get computer name error!"
		$s4 = "----client system info----"
		$s5 = "stfile"
		$s6 = "cmd success!"
		
	condition:
		all of them
}

rule BOUNCER_APT1 {
	strings:
		$s1 = "*Qd9kdgba33*%Wkda0Qd3kvn$*&><(*&%$E#%$#1234asdgKNAg@!gy565dtfbasdg"
		$s2 = "IDR_DATA%d"
		
		$s3 = "asdfqwe123cxz"
		$s4 = "Mode must be 0(encrypt) or 1(decrypt)."
		
	condition:
		($s1 and $s2) or ($s3 and $s4)
		
}

rule BOUNCER_DLL_APT1 {
	strings:
		$s1 = "new_connection_to_bounce():"
		$s2 = "usage:%s IP port [proxip] [port] [key]"
		
	condition:
		all of them
}

rule CALENDAR_APT1 {
	strings:
		$s1 = "content"
		$s2 = "title"
		$s3 = "entry" 
		$s4 = "feed"
		$s5 = "DownRun success"
		$s6 = "%s@gmail.com"
		$s7 = "<!--%s-->"
		
		$b8 = "W4qKihsb+So="
		$b9 = "PoqKigY7ggH+VcnqnTcmhFCo9w=="
		$b10 = "8oqKiqb5880/uJLzAsY="
		
	condition:
		all of ($s*) or all of ($b*)
}

rule COMBOS_APT1 {
	strings:
		$s1 = "Mozilla4.0 (compatible; MSIE 7.0; Win32)"
		$s2 = "Mozilla5.1 (compatible; MSIE 8.0; Win32)"
		$s3 = "Delay"
		$s4 = "Getfile"
		$s5 = "Putfile"
		$s6 = "---[ Virtual Shell]---" wide ascii
		$s7 = "Not Comming From Our Server %s."
		
		
	condition:
		all of them
}

rule DAIRY_APT1 {
	strings:
		$s1 = "Mozilla/4.0 (compatible; MSIE 7.0;)"
		$s2 = "KilFail"
		$s3 = "KilSucc"
		$s4 = "pkkill"
		$s5 = "pklist"
		
		
	condition:
		all of them
}

rule GLOOXMAIL_APT1 {
	strings:
		$s1 = "Kill process success!"
		$s2 = "Kill process failed!"
		$s3 = "Sleep success!"
		$s4 = "based on gloox"
		
		$pdb = "glooxtest.pdb"
		
	condition:
		all of ($s*) or $pdb
}

rule GOGGLES_APT1 {
	strings:
		$s1 = "Kill process success!"
		$s2 = "Kill process failed!"
		$s3 = "Sleep success!"
		$s4 = "based on gloox"
		
		$pdb = "glooxtest.pdb"
		
	condition:
		all of ($s*) or $pdb
}

rule HACKSFASE1_APT1 {
	strings:
		$s1 = {cb 39 82 49 42 be 1f 3a}
		
	condition:
		all of them
}

rule HACKSFASE2_APT1 {
	strings:
		$s1 = "Send to Server failed."
		$s2 = "HandShake with the server failed. Error:"
		$s3 = "Decryption Failed. Context Expired."
		
	condition:
		all of them
}



rule KURTON_APT1 {
	strings:
		$s1 = "Mozilla/4.0 (compatible; MSIE8.0; Windows NT 5.1)"
		$s2 = "!(*@)(!@PORT!(*@)(!@URL"
		$s3 = "MyTmpFile.Dat"
		$s4 = "SvcHost.DLL.log"
		
	condition:
		all of them
}

rule LONGRUN_APT1 {
	strings:
		$s1 = "Mozilla/4.0 (compatible; Windows NT 5.1; MSIE 7.0; Trident/4.0)"
		$s2 = "%s\\%c%c%c%c%c%c%c"
		$s3 = "wait:"
		$s4 = "Dcryption Error! Invalid Character"
		
	condition:
		all of them
}

rule MACROMAIL_APT1 {
	strings:
		$s1 = "svcMsn.dll"
		$s2 = "RundllInstall"
		$s3 = "Config service %s ok."
		$s4 = "svchost.exe"
		
	condition:
		all of them
}

rule MANITSME_APT1 {
	strings:
		$s1 = "Install an Service hosted by SVCHOST."
		$s2 = "The Dll file that to be released."
		$s3 = "SYSTEM\\CurrentControlSet\\Services\\"
		$s4 = "svchost.exe"
		
		$e1 = "Man,it's me"
		$e2 = "Oh,shit"
		$e3 = "Hallelujah"
		$e4 = "nRet == SOCKET_ERROR"
		
		$pdb1 = "rouji\\release\\Install.pdb"
		$pdb2 = "rouji\\SvcMain.pdb"
		
	condition:
		(all of ($s*)) or (all of ($e*)) or $pdb1 or $pdb2
}

rule MINIASP_APT1 {
	strings:
		$s1 = "miniasp"
		$s2 = "wakeup="
		$s3 = "download ok!"
		$s4 = "command is null!"
		$s5 = "device_input.asp?device_t="
		
		
	condition:
		all of them
}

rule NEWSREELS_APT1 {
	strings:
		$s1 = "Mozilla/4.0 (compatible; Windows NT 5.1; MSIE 7.0)"
		$s2 = "name=%s&userid=%04d&other=%c%s"
		$s3 = "download ok!"
		$s4 = "command is null!"
		$s5 = "noclient"
		$s6 = "wait"
		$s7 = "active"
		$s8 = "hello"
		
		
	condition:
		all of them
}

rule SEASALT_APT1 {
	strings:
		$s1 = "User-Agent: Mozilla/4.0 (compatible; MSIE 5.00; Windows 98) KSMM"
		$s2 = "upfileok"
		$s3 = "download ok!"
		$s4 = "upfileer"
		$s5 = "fxftest"
		
		
	condition:
		all of them
}

rule STARSYPOUND_APT1 {
	strings:
		$s1 = "*(SY)# cmd"
		$s2 = "send = %d"
		$s3 = "cmd.exe"
		$s4 = "*(SY)#"
		
		
	condition:
		all of them
}

rule SWORD_APT1 {
	strings:
		$s1 = "@***@*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@>>>"
		$s2 = "sleep:"
		$s3 = "down:"
		$s4 = "*========== Bye Bye ! ==========*"
		
		
	condition:
		all of them
}


rule thequickbrow_APT1 {
	strings:
		$s1 = "thequickbrownfxjmpsvalzydg"
		
		
	condition:
		all of them
}


rule TABMSGSQL_APT1 {
	strings:
		$s1 = "letusgohtppmmv2.0.0.1"
		$s2 = "Mozilla/4.0 (compatible; )"
		$s3 = "filestoc"
		$s4 = "filectos"
		$s5 = "reshell"
		
	condition:
		all of them
}

rule CCREWBACK1 
{
  strings:
    $a = "postvalue" 
    $b = "postdata" 
    $c = "postfile"
    $d = "hostname"
    $e = "clientkey"
    $f = "start Cmd Failure!"
    $g = "sleep:"
    $h = "downloadcopy:"
    $i = "download:"
    $j = "geturl:"
    $k = "1.234.1.68"
    
  condition: 
    4 of ($a,$b,$c,$d,$e) or $f or 3 of ($g,$h,$i,$j) or $k
}

rule TrojanCookies_CCREW
{
  strings:
    $a = "sleep:" 
    $b = "content=" 
    $c = "reqpath="
    $d = "savepath="
    $e = "command="

    
  condition: 
    4 of ($a,$b,$c,$d,$e)
}

rule GEN_CCREW1
{
  strings:
    $a = "W!r@o#n$g"
    $b = "KerNel32.dll"
    
  condition: 
    any of them
}

rule Elise
{
  strings: 
    $a = "SetElise.pdb"

  condition:
    $a              
}

rule EclipseSunCloudRAT
{
  strings: 
    $a = "Eclipse_A"
    $b = "\\PJTS\\"
    $c = "Eclipse_Client_B.pdb"
    $d = "XiaoME"
    $e = "SunCloud-Code"
    $f = "/uc_server/data/forum.asp"

  condition:
    any of them             
}

rule MoonProject
{
  strings:
    $a = "Serverfile is smaller than Clientfile"
    $b = "\\M tools\\"
    $c = "MoonDLL"
	$d = "\\M tools\\"
    
  condition:
    any of them
}

rule ccrewDownloader1
{
  strings:
    $a = {DD B5 61 F0 20 47 20 57 D6 65 9C CB 31 1B 65 42}

  condition:
    any of them
}

rule ccrewDownloader2
{
  strings:
    $a = "3gZFQOBtY3sifNOl"
	$b = "docbWUWsc2gRMv9HN7TFnvnKcrWUUFdAEem9DkqRALoD"
	$c = "6QVSOZHQPCMc2A8HXdsfuNZcmUnIqWrOIjrjwOeagILnnScxadKEr1H2MZNwSnaJ"

  condition:
    any of them
}


rule ccrewMiniasp
{
  strings:
    $a = "MiniAsp.pdb"
    $b = "device_t="

  condition:
    any of them
}


rule ccrewSSLBack2
{
  strings:
    $a = {39 82 49 42 BE 1F 3A}

  condition:
    any of them
}

rule ccrewSSLBack3
{
  strings:
    $a = "SLYHKAAY"

  condition:
    any of them
}


rule ccrewSSLBack1
{
  strings:
    $a = "!@#%$^#@!"
    $b = "64.91.80.6"

  condition:
    any of them
}

rule ccrewDownloader3
{
  strings:
    $a = "ejlcmbv"
	$b = "bhxjuisv"
	$c = "yqzgrh"
	$d = "uqusofrp"
	$e = "Ljpltmivvdcbb"
	$f = "frfogjviirr"
	$g = "ximhttoskop"
  condition:
    4 of them
}


rule ccrewQAZ
{
  strings:
    $a = "!QAZ@WSX"

  condition:
    $a
}

rule metaxcd
{
  strings: 
    $a = "<meta xcd="

  condition:
    $a              
}

rule MiniASP
{
strings:
    $KEY = { 71 30 6E 63 39 77 38 65 64 61 6F 69 75 6B 32 6D 7A 72 66 79 33 78 74 31 70 35 6C 73 36 37 67 34 62 76 68 6A }
    $PDB = "MiniAsp.pdb" nocase

condition:
    any of them
}

rule DownloaderPossibleCCrew
{
  strings:
    $a = "%s?%.6u"
    $b = "szFileUrl=%s"
    $c = "status=%u"
    $d = "down file success"
	$e = "Mozilla/4.0 (compatible; MSIE 6.0; Win32)"

  condition:
    all of them
}

rule APT1_MAPIGET
{
    meta:
        author = "AlienVault Labs"

    strings:
        $s1 = "%s\\Attachment.dat" wide ascii
        $s2 = "MyOutlook" wide ascii
        $s3 = "mail.txt"
        $s4 = "Recv Time:"
        $s5 = "Subject:"

    condition:
        all of them
}

rule APT1_LIGHTBOLT
{
    meta:
        author = "AlienVault Labs"

    strings:
        $str1 = "bits.exe"
        $str2 = "PDFBROW"
        $str3 = "Browser.exe"
        $str4 = "Protect!"
    condition:
        2 of them
}

rule APT1_GETMAIL
{
    meta:
        author = "AlienVault Labs"

    strings:
        $stra1 = "pls give the FULL path"
        $stra2 = "mapi32.dll"
        $stra3 = "doCompress"

        $strb1 = "getmail.dll"
        $strb2 = "doCompress"
        $strb3 = "love"
    condition:
        all of ($stra*) or all of ($strb*)
}

rule APT1_GDOCUPLOAD
{
    meta:
        author = "AlienVault Labs"

    strings:
        $str1 = "name=\"GALX\""
        $str2 = "User-Agent: Shockwave Flash"
        $str3 = "add cookie failed..."
        $str4 = ",speed=%f"
    condition:
        3 of them
}

rule APT1_WEBC2_Y21K
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "Y29ubmVjdA" // connect
        $2 = "c2xlZXA" // sleep
        $3 = "cXVpdA" // quit
        $4 = "Y21k" // cmd
        $5 = "dW5zdXBwb3J0" // unsupport
    condition:
        3 of them
}

rule APT1_WEBC2_YAHOO
{
    meta:
        author = "AlienVault Labs"

    strings:
        $http1 = "HTTP/1.0"
        $http2 = "Content-Type:"
        $uagent = "IPHONE8.5(host:%s,ip:%s)"
    condition:
        all of them
}

rule APT1_WEBC2_UGX
{
    meta:
        author = "AlienVault Labs"

    strings:
        $persis = "SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN"
        $exe = "DefWatch.exe"
        $html = "index1.html"
        $cmd1 = "!@#tiuq#@!"
        $cmd2 = "!@#dmc#@!"
        $cmd3 = "!@#troppusnu#@!"
    condition:
        3 of them
}

rule APT1_WEBC2_TOCK
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "InprocServer32"
        $2 = "HKEY_PERFORMANCE_DATA"
        $3 = "<!---[<if IE 5>]id="
    condition:
        all of them
}

rule APT1_WEBC2_TABLE
{
    meta:
        author = "AlienVault Labs"

    strings:
        $msg1 = "Fail To Execute The Command"
        $msg2 = "Execute The Command Successfully"
        $gif1 = /\w+\.gif/
        $gif2 = "GIF89"
    condition:
        3 of them
}

rule APT1_WEBC2_RAVE
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "iniet.exe"
        $2 = "cmd.exe"
        $3 = "SYSTEM\\CurrentControlSet\\Services\\DEVFS"
        $4 = "Device File System"
    condition:
        3 of them
}

rule APT1_WEBC2_QBP
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "2010QBP"
        $2 = "adobe_sl.exe"
        $3 = "URLDownloadToCacheFile"
        $4 = "dnsapi.dll"
        $5 = "urlmon.dll"
    condition:
        4 of them
}

rule APT1_WEBC2_KT3
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "*!Kt3+v|"
        $2 = " s:"
        $3 = " dne"
    condition:
        all of them
}

rule APT1_WEBC2_HEAD
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "Ready!"
        $2 = "connect ok"
        $3 = "WinHTTP 1.0"
        $4 = "<head>"
    condition:
        all of them
}

rule APT1_WEBC2_GREENCAT
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "reader_sl.exe"
        $2 = "MS80547.bat"
        $3 = "ADR32"
        $4 = "ControlService failed!"
    condition:
        3 of them
}

rule APT1_WEBC2_DIV
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "3DC76854-C328-43D7-9E07-24BF894F8EF5"
        $2 = "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"
        $3 = "Hello from MFC!"
        $4 = "Microsoft Internet Explorer"
    condition:
        3 of them
}

rule APT1_WEBC2_CSON
{
    meta:
        author = "AlienVault Labs"

    strings:
        $httpa1 = "/Default.aspx?INDEX="
        $httpa2 = "/Default.aspx?ID="
        $httpb1 = "Win32"
        $httpb2 = "Accept: text*/*"
        $exe1 = "xcmd.exe"
        $exe2 = "Google.exe"
    condition:
        1 of ($exe*) and 1 of ($httpa*) and all of ($httpb*)
}

rule APT1_WEBC2_CLOVER
{
    meta:
        author = "AlienVault Labs"

    strings:
        $msg1 = "BUILD ERROR!"
        $msg2 = "SUCCESS!"
        $msg3 = "wild scan"
        $msg4 = "Code too clever"
        $msg5 = "insufficient lookahead"
        $ua1 = "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT 5.1; SV1)"
        $ua2 = "Mozilla/5.0 (Windows; Windows NT 5.1; en-US; rv:1.8.0.12) Firefox/1.5.0.12"
    condition:
        2 of ($msg*) and 1 of ($ua*)
}

rule APT1_WEBC2_BOLID
{
    meta:
        author = "AlienVault Labs"

    strings:
        $vm = "VMProtect"
        $http = "http://[c2_location]/[page].html"
    condition:
        all of them
}

rule APT1_WEBC2_ADSPACE
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "<!---HEADER ADSPACE style="
        $2 = "ERSVC.DLL"
    condition:
        all of them
}

rule APT1_WEBC2_AUSOV
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "ntshrui.dll"
        $2 = "%SystemRoot%\\System32\\"
        $3 = "<!--DOCHTML"
        $4 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)"
        $5 = "Ausov"
    condition:
        4 of them
}

rule APT1_WARP
{
    meta:
        author = "AlienVault Labs"

    strings:
        $err1 = "exception..."
        $err2 = "failed..."
        $err3 = "opened..."
        $exe1 = "cmd.exe"
        $exe2 = "ISUN32.EXE"
    condition:
        2 of ($err*) and all of ($exe*)
}

rule APT1_TARSIP_ECLIPSE
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "\\pipe\\ssnp"
        $2 = "toobu.ini"
        $3 = "Serverfile is not bigger than Clientfile"
        $4 = "URL download success"
    condition:
        3 of them
}

rule APT1_TARSIP_MOON
{
    meta:
        author = "AlienVault Labs"

    strings:
        $s1 = "\\XiaoME\\SunCloud-Code\\moon"
        $s2 = "URL download success!"
        $s3 = "Kugoosoft"
        $msg1 = "Modify file failed!! So strange!"
        $msg2 = "Create cmd process failed!"
        $msg3 = "The command has not been implemented!"
        $msg4 = "Runas success!"
        $onec1 = "onec.php"
        $onec2 = "/bin/onec"
    condition:
        1 of ($s*) and 1 of ($msg*) and 1 of ($onec*)
}

private rule APT1_payloads
{
    meta:
        author = "AlienVault Labs"

    strings:
        $pay1 = "rusinfo.exe"
        $pay2 = "cmd.exe"
        $pay3 = "AdobeUpdater.exe"
        $pay4 = "buildout.exe"
        $pay5 = "DefWatch.exe"
        $pay6 = "d.exe"
        $pay7 = "em.exe"
        $pay8 = "IMSCMig.exe"
        $pay9 = "localfile.exe"
        $pay10 = "md.exe"
        $pay11 = "mdm.exe"
        $pay12 = "mimikatz.exe"
        $pay13 = "msdev.exe"
        $pay14 = "ntoskrnl.exe"
        $pay15 = "p.exe"
        $pay16 = "otepad.exe"
        $pay17 = "reg.exe"
        $pay18 = "regsvr.exe"
        $pay19 = "runinfo.exe"
        $pay20 = "AdobeUpdate.exe"
        $pay21 = "inetinfo.exe"
        $pay22 = "svehost.exe"
        $pay23 = "update.exe"
        $pay24 = "NTLMHash.exe"
        $pay25 = "wpnpinst.exe"
        $pay26 = "WSDbg.exe"
        $pay27 = "xcmd.exe"
        $pay28 = "adobeup.exe"
        $pay29 = "0830.bin"
        $pay30 = "1001.bin"
        $pay31 = "a.bin"
        $pay32 = "ISUN32.EXE"
        $pay33 = "AcroRD32.EXE"
        $pay34 = "INETINFO.EXE"
    condition:
        1 of them
}

rule APT1_readynewcmd
{
    meta:
        author = "AlienVault Labs"

    strings:
        $msg1 = "Ready!"
        $msg2 = "connect ok"
        $msg4 = "new.new"
        $msg5 = "connect %s"
    condition:
        all of them and APT1_payloads
}

rule APT1_RARSilent_EXE_PDF
{
    meta:
        author = "AlienVault Labs"

    strings:
        $winrar1 = "WINRAR.SFX"
        $winrar2 = ";The comment below contains SFX script commands"
        $winrar3 = "Silent=1"

        $str1 = /Setup=[\s\w\"]+\.(exe|pdf)/
        $str2 = "Steup=\""
    condition:
        all of ($winrar*) and 1 of ($str*)
}

rule APT1_dbg_mess
{
    meta:
        author = "AlienVault Labs"

    strings:
        $dbg1 = "Down file ok!"
        $dbg2 = "Send file ok!"
        $dbg3 = "Command Error!"
        $dbg4 = "Pls choose target first!"
        $dbg5 = "Alert!"
        $dbg6 = "Pls press enter to make sure!"
        $dbg7 = "Are you sure to "
    condition:
        4 of them and APT1_payloads
}

rule APT1_filetran_project
{
    meta:
        author = "AlienVault Labs"

    strings:
        $dbgroute = "c:\\project\\filetran\\sender\\release\\Sender.pdb"
    condition:
        $dbgroute
}

rule APT1_SY
{
    meta:
        author = "AlienVault Labs"

    strings:
        $cmd = "*(SY)#"
        $send = "send = %d"
    condition:
        all of them and APT1_payloads
}

rule APT1_aspnetreport
{
    meta:
        author = "AlienVault Labs"

    strings:
        $url = "aspnet_client/report.asp"
        $param = "name=%s&Gender=%c&Random=%04d&SessionKey=%s"
    condition:
        $url and $param and APT1_payloads
}

rule APT1_points
{
    meta:
        author = "AlienVault Labs"

    strings:
        $err1 = "exception..."
        $err2 = "failed..."
        $err3 = "opened..."
    condition:
        2 of ($err*) and APT1_payloads
}

rule APT1_uagent1
{
    meta:
        author = "AlienVault Labs"

    strings:
        $ua = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; %s.%s)"
        $f1 = ".exe"
        $f2 = ".tmp"
        $persis = "Software\\Microsoft\\Windows\\CurrentVersion\\Run"
    condition:
        all of them
}

rule APT1_svchost_temp
{
    meta:
        author = "AlienVault Labs"

    strings:
        $a = "\\svchost.exe"
        $b = "%temp%"
        $c = "URLDownloadToFileA"
        $d = "InternetReadFile"
        $e = "InternetOpen"
    condition:
        all of them
}

rule APT1_Revird_svc
{
    meta:
        author = "AlienVault Labs"

    strings:
        $dll1 = "nwwwks.dll"
        $dll2 = "rdisk.dll"
        $dll3 = "skeys.dll"
        $dll4 = "SvcHost.DLL.log"
        $svc1 = "InstallService"
        $svc2 = "RundllInstallA"
        $svc3 = "RundllUninstallA"
        $svc4 = "ServiceMain"
        $svc5 = "UninstallService"
    condition:
        1 of ($dll*) and 2 of ($svc*)
}

rule APT1_uagent_iphone85
{
    meta:
        author = "AlienVault Labs"

    strings:
        $http1 = "HTTP/1.0"
        $http2 = "Content-Type:"
        $uagent = "IPHONE8.5(host:%s,ip:%s)"
    condition:
        all of them
}

rule APT1_letusgo
{
    meta:
        author = "AlienVault Labs"

    strings:
        $letus = /letusgo[\w]+v\d\d?\./
    condition:
        $letus
}

rule APT1_b64_cnc_commands
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "Y29ubmVjdA" // connect
        $2 = "c2xlZXA" // sleep
        $3 = "cXVpdA" // quit
        $4 = "Y21k" // cmd
        $5 = "dW5zdXBwb3J0" // unsupport
    condition:
        3 of them
}

rule APT1_cnc_commands
{
    meta:
        author = "AlienVault Labs"

    strings:
        $1 = "noclient"
        $2 = "wait"
        $3 = "active"
        $4 = "hello"
        $5 = "exit"
        $6 = "remove"
        $7 = "filestoc"
        $8 = "filectos"
        $9 = "runfile"
        $10 = "killp"
        $11 = "listp"
        $12 = "reshell"
        $13 = "downfile"
        $14 = "upfile"
        $15 = "quitz"
        $16 = "delclient"
        $17 = "listclients"
    condition:
        4 of them and APT1_payloads
}

rule APT1_exec_gif_cmd
{
    meta:
        author = "AlienVault Labs"

    strings:
        $msg1 = "Fail To Execute The Command"
        $msg2 = "Execute The Command Successfully"
        $gif1 = /\w+\.gif/
        $gif2 = "GIF89"
    condition:
        all of them
}
